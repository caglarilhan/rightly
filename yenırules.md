Harika! ğŸ¯ O zaman sana â€œkesin para verdirenâ€ yeni Ã¶zelliklerin detaylÄ± PRDâ€™sini Ã§Ä±karayÄ±m.
Mevcut yapÄ±yÄ± bozmadan, Ã¼zerine enterprise seviyede gelir getirecek katmanlarÄ± ekleyeceÄŸiz. ğŸš€

â¸»

ğŸ“‘ Rightly Compliance â€” Yeni Ã–zellikler PRD (vNext)

ğŸ¯ AmaÃ§

Mevcut core Ã¶zellikler (DSAR Portal, Otomatik Ä°ÅŸleme, Audit Log) yanÄ±na, mÃ¼ÅŸterilerin cÃ¼zdanÄ± Ã§Ä±karacaÄŸÄ± high-value Ã¶zellikleri eklemek. Bu Ã¶zellikler regÃ¼lasyon riskini azaltacak, enterprise dealâ€™larÄ± aÃ§acak ve ARRâ€™i yukarÄ± Ã§ekecek.

â¸»

1. Data Breach Management (Ä°hlal YÃ¶netimi) ğŸš¨

KullanÄ±cÄ± Sorunu
	â€¢	GDPR/CCPA/KVKK â†’ 72 saat iÃ§inde ihlal bildirme zorunluluÄŸu.
	â€¢	Ã‡oÄŸu ÅŸirket bunu Excel + e-mail ile takip ediyor â†’ bÃ¼yÃ¼k risk.

Ã‡Ã¶zÃ¼m
	â€¢	Ä°hlal kaydÄ± aÃ§ma â†’ etkilenen kiÅŸi sayÄ±sÄ±, etkilenen veri tipleri, risk seviyesi.
	â€¢	RegÃ¼latÃ¶r iÃ§in otomatik rapor PDF.
	â€¢	72 saat geri sayÄ±m + e-posta hatÄ±rlatma.

Ã–zellikler
	â€¢	ğŸ“„ Ä°hlal raporu oluÅŸturma formu
	â€¢	â± 72 saat â€œcountdown timerâ€
	â€¢	ğŸ“Š Ä°hlal dashboardâ€™u (tip, seviye, status)
	â€¢	ğŸ“¤ RegÃ¼lasyona Ã¶zel export (EU, TR, US)

Monetization
	â€¢	Pro/Enterprise add-on (aylÄ±k ekstra Ã¼cret).
	â€¢	â€œBreach Response Packâ€ adÄ±yla ayrÄ± satÄ±labilir.

â¸»

2. Consent & Preference Management (Ä°zin YÃ¶netimi) âœ…

KullanÄ±cÄ± Sorunu
	â€¢	KullanÄ±cÄ± izinlerini yÃ¶netmek (e-posta, SMS, push) da compliance kapsamÄ±.
	â€¢	â€œBen bu mesajÄ± almayÄ± reddettimâ€ â†’ dava riski.

Ã‡Ã¶zÃ¼m
	â€¢	Tek bir Preference Center sayfasÄ± â†’ kullanÄ±cÄ± kendi izinlerini gÃ¶rÃ¼p gÃ¼nceller.
	â€¢	Double opt-in, opt-out kayÄ±tlarÄ± â†’ audit logâ€™a entegre.

Ã–zellikler
	â€¢	ğŸŒ Public Preference Center (white-label)
	â€¢	ğŸ” Auditâ€™te izin deÄŸiÅŸiklikleri gÃ¶rÃ¼nÃ¼r
	â€¢	âš¡ API: Marketing automation (Mailchimp, HubSpot)

Monetization
	â€¢	Pro plan Ã¼stÃ¼ â†’ mÃ¼ÅŸteri retention artÄ±rÄ±r, pazarlama ekipleri iÃ§in must-have.

â¸»

3. Automated DPIA / ROPA (Risk & Envanter YÃ¶netimi) ğŸ›¡ï¸

KullanÄ±cÄ± Sorunu
	â€¢	GDPR Art. 35 & 30 â†’ DPIA (Data Protection Impact Assessment) ve ROPA zorunlu.
	â€¢	Ã‡oÄŸu ÅŸirket Excelâ€™de â†’ daÄŸÄ±nÄ±k, denetimde sorun.

Ã‡Ã¶zÃ¼m
	â€¢	Yeni sistem/process eklendiÄŸinde AI-assisted DPIA formu otomatik doldurulur.
	â€¢	ROPA (iÅŸleme faaliyet envanteri) tek panelden export edilir.

Ã–zellikler
	â€¢	âš™ï¸ â€œAdd Processâ€ wizard
	â€¢	ğŸ¤– Risk Ã¶neri motoru (AI)
	â€¢	ğŸ“¤ ROPA/DPIA export (Word/PDF)

Monetization
	â€¢	Enterprise feature â†’ yÄ±llÄ±k 5â€“6 haneli kontratlar.

â¸»

4. Multi-Region Compliance Hub ğŸŒ

KullanÄ±cÄ± Sorunu
	â€¢	Global firmalar iÃ§in GDPR + CCPA + KVKK ayrÄ± yÃ¶netim yÃ¼kÃ¼.

Ã‡Ã¶zÃ¼m
	â€¢	Tek DSAR â†’ sistem otomatik olarak hangi kanuna gÃ¶re iÅŸleneceÄŸini seÃ§er.
	â€¢	Region-based workflow â†’ farklÄ± SLAâ€™lar, farklÄ± formatlar.

Ã–zellikler
	â€¢	ğŸŒ RegÃ¼lasyon motoru (GDPR / CCPA / KVKK / LGPD)
	â€¢	ğŸ—‚ Region-specific templates
	â€¢	ğŸ“Š Multi-region dashboard

Monetization
	â€¢	Enterprise add-on
	â€¢	Global firmalar iÃ§in USP (rakiplerden ayrÄ±ÅŸtÄ±rÄ±cÄ±).

â¸»

5. Legal Templates & Regulator Export ğŸ“‘

KullanÄ±cÄ± Sorunu
	â€¢	Denetim geldiÄŸinde â€œkanÄ±t paketiâ€ hazÄ±rlamak Ã§ok zaman alÄ±yor.

Ã‡Ã¶zÃ¼m
	â€¢	Tek tÄ±kla regÃ¼latÃ¶r iÃ§in hazÄ±r export:
	â€¢	DSAR talepleri listesi
	â€¢	Breach raporlarÄ±
	â€¢	Consent loglarÄ±
	â€¢	Audit kayÄ±tlarÄ±

Ã–zellikler
	â€¢	ğŸ“¦ â€œExport for Regulatorâ€ butonu
	â€¢	ğŸ” PDF + JSON seÃ§enekleri
	â€¢	ğŸ“Š Audit-ready bundle

Monetization
	â€¢	Pro+ paketine dahil
	â€¢	â€œDenetim korkusuâ€ olan ÅŸirketler iÃ§in gÃ¼Ã§lÃ¼ satÄ±ÅŸ argÃ¼manÄ±.

â¸»

ğŸ† Paketleme Stratejisi
	â€¢	Core (Basic): DSAR Portal + Otomatik Ä°ÅŸleme + Audit Log
	â€¢	Pro: Consent Hub + Legal Templates
	â€¢	Enterprise: Data Breach Management + DPIA/ROPA + Multi-Region Hub

â¸»

ğŸ“Š Beklenen Etki
	â€¢	Conversion: Pro/Enterprise upgrade oranÄ± %20 artar
	â€¢	Revenue: ARPU 2â€“3x artÄ±ÅŸÄ±
	â€¢	Stickiness: â€œBreach + DPIAâ€ â†’ mÃ¼ÅŸteriler kolay kolay Ã§Ä±kamaz
	â€¢	Differentiation: Rakiplerden ayrÄ±ÅŸtÄ±rÄ±cÄ± USP â†’ Category Leader pozisyonu

â¸»
SÃ¼perâ€”hemen â€œpara verdirenâ€ vNext Ã¶zellikleri iÃ§in Backend ve Frontend mimarisini netleÅŸtiriyorum ve en altta Cursorâ€™a yapÄ±ÅŸtÄ±r-Ã§alÄ±ÅŸtÄ±r bir â€œtek gÃ¶revliâ€ prompt veriyorum. Bu Ã¼Ã§lÃ¼ paketi aynen kopyalayÄ±p ekibe daÄŸÄ±tabilirsin. ğŸš€

â¸»

ğŸ§± Backend Detay TasarÄ±m (FastAPI + Postgres + Redis + Celery)

0) Kapsam (vNext â€“ gelir odaklÄ±)
	1.	Data Breach Management (72h timer, regulator export)
	2.	Consent & Preference Center (public endpoint + audit)
	3.	DPIA / ROPA (process envanteri + risk scoring)
	4.	Multi-Region Compliance (GDPR/CCPA/KVKK auto-routing)
	5.	Regulator Export Bundle (tek tÄ±k PDF/JSON)

1) Servis Topolojisi
	â€¢	API: FastAPI (sync I/O), Pydantic v2 ÅŸemalarÄ±
	â€¢	DB: PostgreSQL (SQLAlchemy + Alembic)
	â€¢	Queue: Celery (Redis broker/result)
	â€¢	Storage: S3/R2 (private bucket, presigned)
	â€¢	Auth: JWT (HS/RS), RBAC (roles/permissions), impersonation (admin)
	â€¢	Observability: OpenTelemetry + structured logs (x-request-id), Prometheus metrics endpoint

2) DizÄ±n YapÄ±sÄ±

backend/
  app/
    main.py
    deps.py
    config.py
    db.py
    security/
      auth.py
      rbac.py
    observability/
      audit.py
      logging.py
      metrics.py
    models/
      user.py
      org.py
      consent.py
      breach.py
      dpia.py
      ropa.py
      export.py
      enums.py
    schemas/
      consent.py
      breach.py
      dpia.py
      ropa.py
      export.py
      common.py
    routes/
      v1/
        consent.py
        breach.py
        dpia.py
        ropa.py
        export.py
        meta.py       # /healthz, /version
        admin.py
    services/
      consent_service.py
      breach_service.py
      dpia_service.py
      ropa_service.py
      export_service.py
      regulator_templates.py
    tasks/
      breach_tasks.py
      export_tasks.py
      housekeeping.py
    migrations/  # Alembic
    __init__.py

3) VeritabanÄ± ÅemasÄ± (Ã¶zet)

Ortak
	â€¢	organizations(id, name, region_default, created_at)
	â€¢	users(id, org_id, email, name, is_super_admin, ... )
	â€¢	audit_events(id, org_id, actor_user_id, action, resource, details_json, severity, created_at)

Consent & Pref
	â€¢	consent_events(id, org_id, subject_id, channel, purpose, status, source, ip, ua, occurred_at)
	â€¢	preferences(id, org_id, subject_id, email_opt_in, sms_opt_in, push_opt_in, updated_at)

Breach
	â€¢	breaches(id, org_id, title, description, severity, started_at, detected_at, reported_at, status, affected_count, data_types[], countdown_deadline)
	â€¢	breach_systems(id, breach_id, system_name, owner, notes)

DPIA/ROPA
	â€¢	processes(id, org_id, name, purpose, lawful_basis, data_categories[], recipients[], storage_location, retention_days)
	â€¢	dpia_assessments(id, org_id, process_id, risk_score, risks[], mitigations[], reviewer_user_id, status, reviewed_at)
	â€¢	ropa_records(id, org_id, process_id, controller, processor, dpo_contact, last_updated)

Export
	â€¢	export_jobs(id, org_id, type, scope, status, requested_by, started_at, finished_at, bundle_key, error)
	â€¢	regulator_exports(id, org_id, breach_id?, timeframe_from, timeframe_to, url, checksum, created_at)

Enumâ€™lar: BreachSeverity={LOW, MEDIUM, HIGH, CRITICAL}, ConsentStatus={OPT_IN, OPT_OUT, WITHDRAWN}, DpiaStatus={DRAFT, REVIEW, APPROVED, REJECTED}, ExportStatus={PENDING,RUNNING,DONE,FAILED}, Regulation={GDPR,CCPA,KVKK,LGPD}.

4) API SÃ¶zleÅŸmeleri (Ã¶zet yollar)

GET  /v1/healthz
GET  /v1/version

# Consent & Pref
POST /v1/consents/event            # body: ConsentEventCreate
GET  /v1/consents/subject/{id}     # son durum + geÃ§miÅŸ
PUT  /v1/preferences/{subject_id}  # preference center update (public token destekli)

# Breach
POST   /v1/breaches                 # yeni ihlal kaydÄ±
GET    /v1/breaches                 # liste + filtre (status,severity,date)
GET    /v1/breaches/{id}
PATCH  /v1/breaches/{id}            # status, reported_at, affected_count...
POST   /v1/breaches/{id}/report     # regulator export job tetikleme

# DPIA / ROPA
POST /v1/processes
GET  /v1/processes
POST /v1/dpia/{process_id}/assess   # AI-assisted risk scoring (sync/async)
GET  /v1/ropa                       # envanter export + sayfalÄ± list

# Multi-Region
POST /v1/dsar/ingest                # requestâ€™ten regulation auto-detect + route

# Export
POST /v1/exports/regulator          # bundle (breach,consents,auditâ€¦) PDF/JSON
GET  /v1/exports/{job_id}/status
GET  /v1/exports/{job_id}/download  # presigned URL

# Admin
GET    /admin/check
GET    /admin/audit
POST   /admin/impersonate
DELETE /admin/impersonate

Pydantic Ã–rnek (kÄ±saltÄ±lmÄ±ÅŸ)

class ConsentEventCreate(BaseModel):
    subject_id: str
    channel: Literal["email","sms","push"]
    purpose: str
    status: Literal["OPT_IN","OPT_OUT","WITHDRAWN"]
    source: str | None = None
    ip: IPvAnyAddress | None = None
    ua: str | None = None
    occurred_at: datetime = Field(default_factory=datetime.utcnow)

5) Servis MantÄ±ÄŸÄ± / GÃ¶revler
	â€¢	breach_tasks.py
	â€¢	schedule_deadline_reminders(breach_id) â†’ T-48/T-24/T-6 mail + Slack
	â€¢	auto_close_if_reported(breach_id)
	â€¢	export_tasks.py
	â€¢	build_regulator_bundle(org_id, filters) â†’ S3â€™e PDF/JSON paketle
	â€¢	housekeeping.py
	â€¢	purge_old_exports(days=30)

6) GÃ¼venlik
	â€¢	RBAC: izinler
	â€¢	consent:write, consent:read, breach:manage, dpia:review, export:run, admin:*
	â€¢	Origin/CORS: whitelist (ENV: ALLOWED_ORIGINS)
	â€¢	Rate limit: /v1/consents/event 60/min, public endpoints token-bound
	â€¢	Audit: her mutasyon â†’ audit_events (severity, actor, acting_as)

7) Test & GÃ¶zlemlenebilirlik
	â€¢	pytest: route tests, service tests (DB transaction rollbacks)
	â€¢	curl smoke: /v1/healthz 200, /v1/breaches CRUD, export flow
	â€¢	Metrics: breach_open_total, consent_event_rate, export_duration_seconds_p95
	â€¢	Tracing: traceparent header, Celery spanâ€™leri

â¸»

ğŸ›ï¸ Frontend Detay TasarÄ±m (Next.js App Router + React Query + Tailwind)

0) KapsamlÄ± Sayfalar

/breaches            # liste + â€œNew Breachâ€ wizard + 72h sayaÃ§
/breaches/[id]       # timeline, affected systems, report dÃ¼ÄŸmesi
/consents            # subject arama, kanal/purpose filtreleri
/preferences/[token] # public preference center (white-label)
/dpia                # process list + risk skoru + review akÄ±ÅŸÄ±
/ropa                # envanter tablosu + export
/exports             # export job durumu + indirme
/admin/*             # (mevcut) users/flags/audit

1) UI Mimari
	â€¢	State: TanStack Query (cache policy, optimistic updates)
	â€¢	Formlar: react-hook-form + zod resolver
	â€¢	BileÅŸenler: shadcn/ui + Tailwind; Card/Button/Badge varyantlarÄ± (Inter 400/500/600, h1 24/32â€¦)
	â€¢	Grafikler: Recharts (sparkline, bar)
	â€¢	i18n: next-intl (EN/TR), regulation metinleri locale-aware
	â€¢	EriÅŸilebilirlik: rozet/etiket kontrast, aria-live toast, focus-visible

2) Veri AkÄ±ÅŸlarÄ±
	â€¢	Breach 72h: detay sayfasÄ±nda countdown; status â€œReportedâ€ olunca otomatik gizlenir
	â€¢	Consent Timeline: subject modal â†’ event list (OPT_IN/OUT), export CSV
	â€¢	DPIA: â€œAdd Processâ€ wizard (3 adÄ±m) â†’ POST /v1/processes â†’ â€œAssess nowâ€ (AI)
	â€¢	ROPA: tablo, facet filtrasyon, Export butonu (PDF/CSV)

3) Mikro-etkileÅŸimler (parlatan)
	â€¢	Top banner: Status badge (LIVE/DEGRADED)
	â€¢	Command Palette (âŒ˜K): â€œNew Breachâ€, â€œAssess DPIAâ€, â€œExport for Regulatorâ€
	â€¢	Usage-based nudge: Export sayÄ±sÄ±nda %80 uyarÄ± (upgrade modal)
	â€¢	Trust Center embed: â€œCompliant: SOC2-readyâ€ rozet

4) Analytics & Events
	â€¢	track('breach_create'), track('regulator_export_start'), track('dpia_assess_click'), track('consent_opt_out'), track('upgrade_prompt_shown')
	â€¢	UTMâ€™ler, pageview, funnel (Visitors â†’ Free signup â†’ Pro upgrade)

5) Ã–rnek API Client (React Query)

export const useBreaches = () =>
  useQuery({ queryKey: ['breaches'], queryFn: () => api.get('/v1/breaches').then(r=>r.data) });

export const useCreateBreach = () =>
  useMutation({
    mutationFn: (body: BreachCreate) => api.post('/v1/breaches', body).then(r=>r.data),
    onSuccess: () => queryClient.invalidateQueries({queryKey:['breaches']})
  });


â¸»

ğŸ§© Kabul Kriterleri (E2E)

Breach
	â€¢	â€œNew Breachâ€ â†’ kayÄ±t oluÅŸur, T-48 email jobâ€™Ä± planlanÄ±r, countdown gÃ¶rÃ¼nÃ¼r
	â€¢	â€œReport to regulatorâ€ â†’ export job DONE, indirilebilir link Ã§alÄ±ÅŸÄ±r

Consent
	â€¢	Public preference sayfasÄ±nda opt-out â†’ consent_events ve preferences gÃ¼ncellenir, auditâ€™e dÃ¼ÅŸer
	â€¢	Subject geÃ§miÅŸi CSV export

DPIA/ROPA
	â€¢	Process ekle â†’ risk skoru hesaplanÄ±r (mock AI) â†’ status REVIEW
	â€¢	ROPA export â†’ dosya iner, checksum doÄŸrulanÄ±r

Multi-Region
	â€¢	/v1/dsar/ingest payloadâ€™da region US ise CCPA akÄ±ÅŸÄ± seÃ§ilir (response regulation: CCPA)

â¸»

ğŸ§  Cursor Ä°Ã§in â€œTek Promptâ€ (kopyala-yapÄ±ÅŸtÄ±r)

AmaÃ§: AÅŸaÄŸÄ±daki mimariye gÃ¶re backend + frontend vNext Ã¶zelliklerini branchâ€™te Ã¼ret, testleri yeÅŸil Ã§alÄ±ÅŸtÄ±r, Ã¶rnek veri tohumla.
Repo: monorepo frontend/ (Next.js) + backend/ (FastAPI)

You are a senior full-stack pair programmer. Work in a new branch `feat/vnext-compliance`.
Follow these rules strictly:

1) Create backend skeleton as described:
   - FastAPI app with modules and folders exactly:
     app/{main.py,deps.py,config.py,db.py}
     app/security/{auth.py,rbac.py}
     app/observability/{audit.py,logging.py,metrics.py}
     app/models/{user.py,org.py,consent.py,breach.py,dpia.py,ropa.py,export.py,enums.py}
     app/schemas/{consent.py,breach.py,dpia.py,ropa.py,export.py,common.py}
     app/routes/v1/{consent.py,breach.py,dpia.py,ropa.py,export.py,meta.py,admin.py}
     app/services/{consent_service.py,breach_service.py,dpia_service.py,ropa_service.py,export_service.py,regulator_templates.py}
     app/tasks/{breach_tasks.py,export_tasks.py,housekeeping.py}
     migrations/ (alembic)
   - Add SQLAlchemy models and Alembic migration for tables listed in the â€œBackend VeritabanÄ± ÅemasÄ±â€.
   - Implement endpoints listed in â€œAPI SÃ¶zleÅŸmeleriâ€, with Pydantic schemas and RBAC permission checks.
   - Add Celery config; implement tasks as stubs that log and update DB.
   - Add /v1/healthz and /v1/version.
   - Implement S3 presigned download in export route (env: S3_BUCKET, S3_REGION, S3_ENDPOINT).
   - Add pytest suite for: breach create + export bundle, preference update + consent event.

2) Create frontend pages and client as described:
   - Next.js App Router pages:
     /breaches, /breaches/[id], /consents, /preferences/[token], /dpia, /ropa, /exports
   - Setup TanStack Query, axios client with baseURL env, interceptors for x-request-id + auth.
   - Build UI with shadcn/ui + Tailwind using the typography scale (Inter, 400/500/600; h1 24/32; h2 18/28; body 14/22).
   - Implement forms with react-hook-form + zod.
   - Add Command Palette (âŒ˜K) and Status badge in header.
   - Implement analytics wrapper `lib/analytics.ts` and fire events per â€œAnalytics & Eventsâ€.

3) Seeds & fixtures:
   - Add a seed script to create one org, admin user, two processes, a sample breach and 50 consent events.
   - Provide `.env.example` with required keys.

4) DX & quality:
   - Add Makefile: `make dev`, `make test`, `make seed`.
   - Add pre-commit (ruff/black/isort for py, eslint+prettier for ts).
   - CI: run pytest and next build.

5) Deliverables:
   - All files committed with meaningful messages.
   - Print final curl commands to prove the flow:
     (a) create breach, (b) trigger regulator export, (c) update preference (public), (d) assess DPIA.
   - Start servers locally and share the test outputs.

Now begin by scaffolding backend folders and Alembic, then proceed file-by-file. At each step, run tests and fix. Do not skip tests.


â¸»

ğŸ”š Son SÃ¶z

Bu planla:
	â€¢	Backend tarafÄ± denetime hazÄ±r (audit + export + timer)
	â€¢	Frontend tarafÄ± gelir Ã¼reten akÄ±ÅŸlara odaklÄ± (breach, consent, dpia/ropa)
	â€¢	Cursor promptâ€™u tek seferde branchâ€™i ayaÄŸa kaldÄ±racak kadar net.

HazÄ±rsan Cursorâ€™a promptâ€™u yapÄ±ÅŸtÄ±r; bittiÄŸinde smoke test curl komutlarÄ±nÄ± ver, doÄŸrulayalÄ±m. ğŸš€